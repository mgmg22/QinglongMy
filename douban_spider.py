metroStations = [
    "莘庄", "外环路", "莲花路", "锦江乐园",
    "上海南站", "漕溪路", "宜山路", "徐家汇", "衡山路", "常熟路",
    "陕西南路", "黄陂南路", "人民广场", "新闸路", "汉中路", "上海火车站", "中山北路", "延长路", "上海马戏城",
    "汶水路", "彭浦新村", "共康路", "通河新村", "呼兰路", "共富新村", "宝安公路", "友谊西路", "富锦路",  # 1号线

    "淞虹路", "北新泾", "威宁路", "娄山关路", "中山公园", "江苏路", "静安寺", "南京西路", "人民广场", "南京东路",
    "陆家嘴", "东昌路", "世纪大道", "上海科技馆", "世纪公园", "龙阳路", "张江高科", "金科路", "广兰路", "唐镇",
    "创新中路", "华夏东路", "川沙", "凌空路", "远东大道", "海天三路", "浦东国际机场",  # 2号线
    "上海南站", "石龙路", "龙漕路", "漕溪路", "宜山路", "虹桥路", "延安西路", "中山公园", "金沙江路", "曹杨路",
    "镇坪路", "中潭路", "上海火车站", "宝山路", "东宝兴路", "虹口足球场", "赤峰路", "延安南路", "江湾镇",
    "殷高西路", "长江南路", "淞发路", "张华浜", "淞滨路",  # 3号线
    "宜山路", "虹桥路", "延安西路", "中山公园", "金沙江路", "曹杨路", "镇坪路", "中潭路", "上海火车站", "宝山路",
    "海伦路", "临平路", "大连路", "杨树浦路", "浦东大道", "世纪大道", "浦电路", "蓝村路", "塘桥", "南浦大桥",  # 4号线
    "莘庄", "春申路", "银都路", "颛桥", "北桥", "剑川路", "东川路", "金平路", "华宁路", "文井路", "闵行开发区",
    # 5号线
    "港城路", "外高桥保税区北", "航津路", "外高桥保税区南", "洲海路", "五洲大道", "东靖路", "巨峰路", "五莲路",
    "博兴路", "金桥路", "云山路", "德平路", "北洋泾路", "民生路", "源深体育中心", "世纪大道", "浦电路",
    "儿童医学中心", "临沂新村", "高科西路", "东明路", "华夏西路", "上南路", "灵岩南路", "东方体育中心",  # 6号线
    "花木路", "龙阳路", "芳华路", "杨高南路", "高科西路", "耀华路", "云台路", "成山路", "东明路", "高青路",
    "华夏西路", "杨思", "上南路", "高科西路", "长清路", "后滩", "世博大道", "云耀路", "耀华路",  # 7号线
    "市光路", "嫩江路", "翔殷路", "黄兴公园", "延吉中路", "黄兴路", "江浦路", "鞍山新村", "四平路", "曲阳路",
    "虹口足球场", "西藏北路", "中兴路", "曲阜路", "人民广场", "大世界", "老西门", "陆家浜路", "西藏南路", "中华路",
    "老西门", "陆家浜路", "西藏南路", "中华路",  # 8号线
    "漕河泾开发区", "合川路", "星中路", "七宝", "中春路", "九亭", "泗泾", "洞泾", "松江大学城", "松江新城",  # 9号线
    "虹桥火车站", "虹桥2号航站楼", "虹桥1号航站楼", "交通大学", "上海图书馆", "陕西南路", "新天地", "豫园",
    "南京东路", "海伦路", "四川北路", "天潼路", "四川北路", "邮电新村", "四平路", "同济大学", "国权路", "五角场",
    "江湾体育场", "新江湾城",  # 10号线
    "嘉定北", "嘉定新城", "白银路", "上海汽车城", "安亭", "兆丰路", "光明路", "花桥",  # 11号线

    "金海路", "申江路", "金京路", "巨峰路", "杨高北路", "金桥路", "浦东足球场", "东陆路", "隆昌路", "宁国路",
    "江浦公园", "大连路",
    "提篮桥", "国际客运中心", "海伦路", "天潼路", "南京西路", "汉中路",
    "陕西南路", "嘉善路",
    "大木桥路", "龙华中路", "龙华", "上海体育馆", "漕宝路", "桂林公园", "虹漕路", "东兰路", "顾戴路", "虹梅路",
    "锦江乐园", "顾戴路", "龙漕路", "石龙路",  # 12号线

    "金运路", "金沙江西路", "丰庄", "祁连山南路", "真北路", "大渡河路", "金沙江路", "武宁路", "长寿路", "江宁路",
    "汉中路", "自然博物馆", "南京西路", "淮海中路", "新天地", "马当路", "世博会博物馆", "成山路", "东明路",
    "华夏西路", "凌兆新村", "芦恒路", "浦江镇",  # 13号线
    "封浜", "乐秀路", "临洮路", "高架路", "金园五路", "金穗路", "祁江西路", "丰茂路", "陆翔路", "马陆", "陈翔公路",
    "上海赛车场", "昌吉东路", "伊宁路", "金海路", "桂桥路", "王桥路", "曹路",  # 14号线
    "顾村公园", "锦秋路", "丰翔路", "南大路", "祁安路", "古浪路", "武威路", "上海西站", "铜川路", "梅岭北路",
    "大渡河路", "长风公园", "怒江路", "华东师大", "金沙江路", "江苏路", "静安寺", "愚园路", "武定路", "长乐路",
    "常熟路", "肇嘉浜路", "嘉善路", "打浦桥", "鲁班路", "西藏南路", "陆家浜路", "大世界", "豫园", "老西门",
    "新闸路", "铜川路", "大渡河路", "金沙江路", "江苏路", "静安寺", "陕西南路", "陕西南路", "新天地", "豫园",
    "海伦路", "四川北路", "天潼路",  # 15号线
    "龙阳路", "华夏中路", "罗山路", "川沙路", "华夏东路", "顾唐路", "民耀路", "申江路", "丹桂路", "唐黄路",
    "凌空路", "浦东机场",  # 16号线
    "诸光路", "蟠龙路", "徐盈路", "徐泾东",  # 17号线
    "航头", "鹤沙航城", "沈梅路", "下沙", "沔北路", "惠南", "人民东路", "上海野生动物园", "滴水湖",  # 18号线
    "虹漕路", "文井路", "华泾", "龙漕路", "高安路",  # 19号线
    "金桥", "王桥", "航城",  # 20号线
    "东方体育中心", "凌兆新村", "三林东", "前滩",  # 21号线
    "吴泾", "紫竹高新区", "江川路", "沪闵路", "石龙路",  # 23号线
    "闵行开发区", "文井路", "剑川路",  # 26号线
    "奉贤新城", "望园路", "金海湖", "海湾",  # 奉贤线
]
# AI prompt使用示例：我女友住在上海南站，我在大连路地铁站上班，我要找靠近地铁站的房子，请帮我排除完全不相干的地铁线路

# !/bin/env python3
# -*- coding: utf-8 -*
# """
# cron: 5 9 * * * weibo_summary.py
# new Env('豆瓣租房');
# """
from bs4 import BeautifulSoup
import requests
import sendNotify

summary_list = []

# # 排除项
user_black_list = [
    "杨浦租房", "五角场租赁", "五角场租房", "PiNa@上海直租", "五角场附近", "沪上蜗居小豆豆",
    "🍃 🇨🇳", "豆友280014083", "瓜瓜一号的墨迹",
    "黄浦区租房",
    "娜娜小夭", "自由奔放", "江湖不良人",
    "华夏东路", "清风秀雅",
    "灵感之刃", "给你俩窝窝", "简单点", "忧伤的旋律", "C",
    "九头奈子", "豆友dda93.0249",
    "兔九九", "忘记了不该忘的",
    "李好闲。", "小张要增肌", "虚伪的世界",
    "森女与鹿林", "提子", "悲伤的诗篇", "相思成殇",
    "安静的等待", "-Joker",
    "豆友279607317", "豆友273774333", "旧梦乱心", "失宠的猫", "氧气柠檬红茶",
    "豆友279607320", "豆友270169870",
    "豆友279607122", "祈鹤", "可怜式.暧情",
    "如花美眷", "豆友279434723", "豆友279434727", "从悲伤中抽离", "豆友1HLEH7JXr4",
    "一切都挺好", "Choo", "sweet", "乐儿",
    "Foo", "克克", "稚气",
]


def filter_tr(tr):
    # print("-----")
    title = tr.select('td.title')
    if not title:
        return False
    if "置顶" in str(title):
        return False
    user = tr.select('td:nth-child(2)')[0].find('a').get_text()
    if user in user_black_list:
        # print(f"过滤：用户 {user} 在黑名单中")
        return False
    text = title[0].find('a')['title'].strip()
    href = title[0].find('a')['href']

    # 排除项
    blackList = [
        "女生", "房源", "公积金", "居住证", "钥匙", "别墅",
        "求租", "预算", "有没有",
        # "闵行", "徐家汇", "漕河泾", "漕宝", "七宝", "虹桥",
        "莘庄",
        "青浦", "泗泾", "周浦",
        "宝山", "上海大学", "呼兰", "彭浦",
        "嘉定",
        "浦东", "陆家嘴", "张江",
        "世纪公园", "龙阳路",
        # "静安",
        "普陀",
        "北新泾",
        # 地铁
        "曙建路", "御桥", "真光路", "大华三路",
        "洲海路", "永德路",
        "金运路", "长江南路",
        "上海马戏城",
        "五号线", "5号线", "闵行开发区",
        "6号线", "港城路", "东方体育中心",
        "7号线", "芳华路", "上大路", "云台路", "杨思", "世博", "花木",
        "八号线", "8号线", "联航路",
        "9号线", "九亭", "松江", "合川路",
        "11号线", "花桥", "迪士尼",
        "14号线", "封浜", "曹路",
        "16号线", "龙阳路", "浦东机场", "顾唐路",
        "17号线", "诸光路", "东方绿舟",
        "18号线", "航头", "滴水湖",
        "19号线", "虹漕路", "高安路",
        "20号线", "金桥", "航城",
        "21号线", "东方体育中心", "前滩", "三林",
        "23号线", "吴泾", "石龙路", "紫竹",
        "26号线", "闵行开发区", "剑川路",
        "奉贤", "海湾",
    ]

    for keyword in blackList:
        if keyword in text:
            # print(f"过滤：标题包含关键词 '{keyword}' - {href}")
            return False

    time = tr.select('td.time')[0].text

    print(text + '\t\t' + time + '\t\t' + user + '\t\t' + href)
    item = {
        'user': user,
        'title': text,
        'href': href,
        'time': time,
    }
    summary_list.append(item)


def get_top_summary(start):
    # url = 'https://www.douban.com/group/wujiaochang/discussion?start='+ str(start)
    # url = 'https://www.douban.com/group/383972/discussion?start='+ str(start)
    url = 'https://www.douban.com/group/shanghaizufang/discussion?start=' + str(start)
    headers = {
        'accept': "*/*",
        'user-agent': "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
    }
    data = requests.get(url, headers=headers)
    data.encoding = 'utf-8'
    soup = BeautifulSoup(data.text, 'html.parser')
    tr_elements = soup.select('#content > div > div.article > div:nth-child(2) > table> tr')
    for tr in tr_elements:
        filter_tr(tr)
    if len(summary_list) <= 20:
        print("-----")
        get_top_summary(start + 25)


if __name__ == '__main__':
    get_top_summary(0)
    # notify_markdown()
