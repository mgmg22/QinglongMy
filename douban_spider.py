metroStations = [
    # 1å·çº¿
    "å¯Œé”¦è·¯", "å‹è°Šè¥¿è·¯", "å®å®‰å…¬è·¯", "å…±å¯Œæ–°æ‘", "å‘¼å…°è·¯", "é€šæ²³æ–°æ‘", "å…±åº·è·¯", "å½­æµ¦æ–°æ‘", "æ±¶æ°´è·¯",
    "ä¸Šæµ·é©¬æˆåŸ", "å»¶é•¿è·¯", "ä¸­å±±åŒ—è·¯", "ä¸Šæµ·ç«è½¦ç«™", "æ±‰ä¸­è·¯", "æ–°é—¸è·¯", "äººæ°‘å¹¿åœº", "é»„é™‚å—è·¯",
    "é™•è¥¿å—è·¯", "å¸¸ç†Ÿè·¯", "è¡¡å±±è·¯", "å¾å®¶æ±‡", "å®œå±±è·¯", "æ¼•æºªè·¯", "ä¸Šæµ·å—ç«™", "é”¦æ±Ÿä¹å›­", "è²èŠ±è·¯",
    "å¤–ç¯è·¯", "è˜åº„",
    # 2å·çº¿
    "å¾æ³¾ä¸œ", "è™¹æ¡¥ç«è½¦ç«™", "è™¹æ¡¥2å·èˆªç«™æ¥¼", "æ·è™¹è·¯", "åŒ—æ–°æ³¾", "å¨å®è·¯", "å¨„å±±å…³è·¯", "ä¸­å±±å…¬å›­",
    "æ±Ÿè‹è·¯", "é™å®‰å¯º", "å—äº¬è¥¿è·¯", "äººæ°‘å¹¿åœº", "å—äº¬ä¸œè·¯", "é™†å®¶å˜´", "ä¸œæ˜Œè·¯", "ä¸–çºªå¤§é“",
    "ä¸Šæµ·ç§‘æŠ€é¦†", "ä¸–çºªå…¬å›­", "é¾™é˜³è·¯", "å¼ æ±Ÿé«˜ç§‘", "é‡‘ç§‘è·¯", "å¹¿å…°è·¯", "å”é•‡", "åˆ›æ–°ä¸­è·¯",
    "åå¤ä¸œè·¯", "å·æ²™", "å‡Œç©ºè·¯", "è¿œä¸œå¤§é“", "æµ·å¤©ä¸‰è·¯", "æµ¦ä¸œå›½é™…æœºåœº",
    # 3å·çº¿
    "ä¸Šæµ·å—ç«™", "çŸ³é¾™è·¯", "é¾™æ¼•è·¯", "æ¼•æºªè·¯", "å®œå±±è·¯", "è™¹æ¡¥è·¯", "å»¶å®‰è¥¿è·¯", "ä¸­å±±å…¬å›­",
    "é‡‘æ²™æ±Ÿè·¯", "æ›¹æ¨è·¯", "é•‡åªè·¯", "ä¸­æ½­è·¯", "ä¸Šæµ·ç«è½¦ç«™", "å®å±±è·¯", "ä¸œå®å…´è·¯", "è™¹å£è¶³çƒåœº",
    "èµ¤å³°è·¯", "å¤§æŸæ ‘", "æ±Ÿæ¹¾é•‡", "æ®·é«˜è¥¿è·¯", "é•¿æ±Ÿå—è·¯", "æ·å‘è·¯", "å¼ åæµœ", "æ·æ»¨è·¯",
    "æ°´äº§è·¯", "å®æ¨è·¯", "å‹è°Šè·¯", "é“åŠ›è·¯", "æ±Ÿæ¨åŒ—è·¯",
    # 4å·çº¿ï¼ˆç¯çº¿ï¼‰
    "å®œå±±è·¯", "è™¹æ¡¥è·¯", "å»¶å®‰è¥¿è·¯", "ä¸­å±±å…¬å›­", "é‡‘æ²™æ±Ÿè·¯", "æ›¹æ¨è·¯", "é•‡åªè·¯", "ä¸­æ½­è·¯",
    "ä¸Šæµ·ç«è½¦ç«™", "å®å±±è·¯", "æµ·ä¼¦è·¯", "ä¸´å¹³è·¯", "å¤§è¿è·¯", "æ¨æ ‘æµ¦è·¯", "æµ¦ä¸œå¤§é“", "ä¸–çºªå¤§é“",
    "æµ¦ç”µè·¯", "è“æ‘è·¯", "å¡˜æ¡¥", "å—æµ¦å¤§æ¡¥", "è¥¿è—å—è·¯", "é²ç­è·¯", "å¤§æœ¨æ¡¥è·¯", "ä¸œå®‰è·¯",
    "ä¸Šæµ·ä½“è‚²åœº", "ä¸Šæµ·ä½“è‚²é¦†", "å®œå±±è·¯",
    # 5å·çº¿
    "è˜åº„", "æ˜¥ç”³è·¯", "é“¶éƒ½è·¯", "é¢›æ¡¥", "åŒ—æ¡¥", "å‰‘å·è·¯", "ä¸œå·è·¯", "é‡‘å¹³è·¯", "åå®è·¯",
    "æ–‡äº•è·¯", "é—µè¡Œå¼€å‘åŒº",
    # 6å·çº¿
    "æ¸¯åŸè·¯", "å¤–é«˜æ¡¥ä¿ç¨åŒºåŒ—", "èˆªæ´¥è·¯", "å¤–é«˜æ¡¥ä¿ç¨åŒºå—", "æ´²æµ·è·¯", "äº”æ´²å¤§é“", "ä¸œé–è·¯",
    "å·¨å³°è·¯", "äº”è²è·¯", "åšå…´è·¯", "é‡‘æ¡¥è·¯", "äº‘å±±è·¯", "å¾·å¹³è·¯", "åŒ—æ´‹æ³¾è·¯", "æ°‘ç”Ÿè·¯",
    "æºæ·±ä½“è‚²ä¸­å¿ƒ", "ä¸–çºªå¤§é“", "æµ¦ç”µè·¯", "è“æ‘è·¯", "å„¿ç«¥åŒ»å­¦ä¸­å¿ƒ", "ä¸´æ²‚æ–°æ‘", "é«˜ç§‘è¥¿è·¯",
    "ä¸œæ˜è·¯", "åå¤è¥¿è·¯", "ä¸Šå—è·¯", "çµå²©å—è·¯", "ä¸œæ–¹ä½“è‚²ä¸­å¿ƒ",
    # 7å·çº¿
    "ç¾å…°æ¹–", "ç½—å—æ–°æ‘", "æ½˜å¹¿è·¯", "åˆ˜è¡Œ", "é¡¾æ‘å…¬å›­", "ç¥åè·¯", "ä¸Šæµ·å¤§å­¦", "å—é™ˆè·¯",
    "ä¸Šå¤§è·¯", "åœºä¸­è·¯", "å¤§åœºé•‡", "è¡ŒçŸ¥è·¯", "å¤§åä¸‰è·¯", "æ–°æ‘è·¯", "å²šçš‹è·¯", "é•‡åªè·¯",
    "é•¿å¯¿è·¯", "æ˜Œå¹³è·¯", "é™å®‰å¯º", "å¸¸ç†Ÿè·¯", "è‚‡å˜‰æµœè·¯", "ä¸œå®‰è·¯", "é¾™åä¸­è·¯", "åæ»©",
    "é•¿æ¸…è·¯", "è€€åè·¯", "äº‘å°è·¯", "é«˜ç§‘è¥¿è·¯", "æ¨é«˜å—è·¯", "é”¦ç»£è·¯", "èŠ³åè·¯", "é¾™é˜³è·¯",
    "èŠ±æœ¨è·¯",
    # 8å·çº¿
    "å¸‚å…‰è·¯", "å«©æ±Ÿè·¯", "ç¿”æ®·è·¯", "é»„å…´å…¬å›­", "å»¶å‰ä¸­è·¯", "é»„å…´è·¯", "æ±Ÿæµ¦è·¯", "éå±±æ–°æ‘",
    "å››å¹³è·¯", "æ›²é˜³è·¯", "è™¹å£è¶³çƒåœº", "è¥¿è—åŒ—è·¯", "ä¸­å…´è·¯", "æ›²é˜œè·¯", "äººæ°‘å¹¿åœº", "å¤§ä¸–ç•Œ",
    "è€è¥¿é—¨", "é™†å®¶æµœè·¯", "è¥¿è—å—è·¯", "ä¸­åè‰ºæœ¯å®«", "è€€åè·¯", "æˆå±±è·¯", "æ¨æ€", "ä¸œæ–¹ä½“è‚²ä¸­å¿ƒ",
    "å‡Œå…†æ–°æ‘", "èŠ¦æ’è·¯", "æµ¦æ±Ÿé•‡", "æ²ˆæœå…¬è·¯",
    # 9å·çº¿
    "æ›¹è·¯", "æ°‘é›·è·¯", "é¡¾å”è·¯", "é‡‘æµ·è·¯", "ç”³æ±Ÿè·¯", "é‡‘æ¡¥", "å°å„¿åº„è·¯", "è“å¤©è·¯", "èŠ³ç”¸è·¯",
    "æ¨é«˜ä¸­è·¯", "ä¸–çºªå¤§é“", "å•†åŸè·¯", "å°å—é—¨", "é™†å®¶æµœè·¯", "é©¬å½“è·¯", "æ‰“æµ¦æ¡¥", "å˜‰å–„è·¯",
    "è‚‡å˜‰æµœè·¯", "å¾å®¶æ±‡", "å®œå±±è·¯", "æ¡‚æ—è·¯", "æ¼•æ²³æ³¾å¼€å‘åŒº", "åˆå·è·¯", "æ˜Ÿä¸­è·¯", "ä¸ƒå®",
    "ä¸­æ˜¥è·¯", "ä¹äº­", "æ³—æ³¾", "ä½˜å±±", "æ´æ³¾", "æ¾æ±Ÿå¤§å­¦åŸ", "æ¾æ±Ÿæ–°åŸ", "æ¾æ±Ÿä½“è‚²ä¸­å¿ƒ",
    "é†‰ç™½æ± ", "æ¾æ±Ÿå—ç«™",
    # 10å·çº¿
    "åŸºéš†è·¯", "æ¸¯åŸè·¯", "é«˜æ¡¥", "é«˜æ¡¥è¥¿", "åŒæ±Ÿè·¯", "å›½å¸†è·¯", "æ–°æ±Ÿæ¹¾åŸ", "æ®·é«˜ä¸œè·¯",
    "ä¸‰é—¨è·¯", "æ±Ÿæ¹¾ä½“è‚²åœº", "äº”è§’åœº", "å›½æƒè·¯", "åŒæµå¤§å­¦", "å››å¹³è·¯", "é‚®ç”µæ–°æ‘", "æµ·ä¼¦è·¯",
    "å››å·åŒ—è·¯", "å¤©æ½¼è·¯", "å—äº¬ä¸œè·¯", "è±«å›­", "è€è¥¿é—¨", "æ–°å¤©åœ°", "é™•è¥¿å—è·¯", "ä¸Šæµ·å›¾ä¹¦é¦†",
    "äº¤é€šå¤§å­¦", "è™¹æ¡¥è·¯", "å®‹å›­è·¯", "ä¼ŠçŠè·¯", "æ°´åŸè·¯", "é¾™æºªè·¯", "ä¸Šæµ·åŠ¨ç‰©å›­", "è™¹æ¡¥1å·èˆªç«™æ¥¼",
    "è™¹æ¡¥2å·èˆªç«™æ¥¼", "è™¹æ¡¥ç«è½¦ç«™", "èˆªä¸­è·¯", "é¾™æŸæ–°æ‘", "ç´«è—¤è·¯", "ä¸ƒè˜è·¯",
    # 11å·çº¿
    "è¿ªå£«å°¼", "åº·æ–°å…¬è·¯", "ç§€æ²¿è·¯", "ç½—å±±è·¯", "å¾¡æ¡¥", "ä¸¥å¾¡è·¯", "æµ¦ä¸‰è·¯", "ä¸‰æ—ä¸œ", "ä¸‰æ—",
    "ä¸œæ–¹ä½“è‚²ä¸­å¿ƒ", "é¾™è€€è·¯", "äº‘é”¦è·¯", "é¾™å", "ä¸Šæµ·æ¸¸æ³³é¦†", "å¾å®¶æ±‡", "äº¤é€šå¤§å­¦", "æ±Ÿè‹è·¯",
    "éš†å¾·è·¯", "æ›¹æ¨è·¯", "æ«æ¡¥è·¯", "çœŸå¦‚", "ä¸Šæµ·è¥¿ç«™", "æå­å›­", "ç¥è¿å±±è·¯", "æ­¦å¨è·¯",
    "æ¡ƒæµ¦æ–°æ‘", "å—ç¿”", "é©¬é™†", "å˜‰å®šæ–°åŸ", "ç™½é“¶è·¯", "å˜‰å®šè¥¿", "å˜‰å®šåŒ—", "ä¸Šæµ·èµ›è½¦åœº",
    "æ˜Œå‰ä¸œè·¯", "ä¸Šæµ·æ±½è½¦åŸ", "å®‰äº­", "å…†ä¸°è·¯", "å…‰æ˜è·¯", "èŠ±æ¡¥",
    # 12å·çº¿
    "ä¸ƒè˜è·¯", "è™¹è˜è·¯", "é¡¾æˆ´è·¯", "ä¸œå…°è·¯", "è™¹æ¢…è·¯", "è™¹æ¼•è·¯", "æ¡‚æ—å…¬å›­", "æ¼•å®è·¯",
    "é¾™æ¼•è·¯", "é¾™å", "é¾™åä¸­è·¯", "å¤§æœ¨æ¡¥è·¯", "å˜‰å–„è·¯", "é™•è¥¿å—è·¯", "å—äº¬è¥¿è·¯", "æ±‰ä¸­è·¯",
    "æ›²é˜œè·¯", "å¤©æ½¼è·¯", "å›½é™…å®¢è¿ä¸­å¿ƒ", "æç¯®æ¡¥", "å¤§è¿è·¯", "æ±Ÿæµ¦å…¬å›­", "å®å›½è·¯", "éš†æ˜Œè·¯",
    "çˆ±å›½è·¯", "å¤å…´å²›", "ä¸œé™†è·¯", "å·¨å³°è·¯", "æ¨é«˜åŒ—è·¯", "é‡‘äº¬è·¯", "ç”³æ±Ÿè·¯", "é‡‘æµ·è·¯",
    # 13å·çº¿
    "é‡‘è¿è·¯", "é‡‘æ²™æ±Ÿè¥¿è·¯", "ä¸°åº„", "ç¥è¿å±±å—è·¯", "çœŸåŒ—è·¯", "å¤§æ¸¡æ²³è·¯", "é‡‘æ²™æ±Ÿè·¯",
    "éš†å¾·è·¯", "æ­¦å®è·¯", "é•¿å¯¿è·¯", "æ±Ÿå®è·¯", "æ±‰ä¸­è·¯", "è‡ªç„¶åšç‰©é¦†", "å—äº¬è¥¿è·¯", "æ·®æµ·ä¸­è·¯",
    "æ–°å¤©åœ°", "é©¬å½“è·¯", "ä¸–åšä¼šåšç‰©é¦†", "ä¸–åšå¤§é“", "é•¿æ¸…è·¯", "æˆå±±è·¯", "ä¸œæ˜è·¯",
    "åé¹è·¯", "ä¸‹å—è·¯", "åŒ—è”¡", "é™ˆæ˜¥è·¯", "è²æºªè·¯", "åå¤ä¸­è·¯", "ä¸­ç§‘è·¯", "å­¦æ—è·¯",
    "å¼ æ±Ÿè·¯",
    # 14å·çº¿
    "å°æµœ", "ä¹ç§€è·¯", "ä¸´æ´®è·¯", "å˜‰æ€¡è·¯", "å®šè¾¹è·¯", "çœŸæ–°æ–°æ‘", "çœŸå…‰è·¯", "é“œå·è·¯",
    "çœŸå¦‚", "ä¸­å®è·¯", "æ›¹æ¨è·¯", "æ­¦å®è·¯", "æ­¦å®šè·¯", "é™å®‰å¯º", "ä¸€å¤§ä¼šå€Â·é»„é™‚å—è·¯",
    "å¤§ä¸–ç•Œ", "è±«å›­", "é™†å®¶å˜´", "æµ¦ä¸œå—è·¯", "æµ¦ä¸œå¤§é“", "æºæ·±è·¯", "æ˜Œé‚‘è·¯", "æ­‡æµ¦è·¯",
    "é¾™å±…è·¯", "äº‘å±±è·¯", "è“å¤©è·¯", "é»„æ¨è·¯", "çº¢æ«è·¯", "é‡‘æ¸¯è·¯", "æ¡‚æ¡¥è·¯",
    # 15å·çº¿
    "é¡¾æ‘å…¬å›­", "é”¦ç§‹è·¯", "ä¸°ç¿”è·¯", "å—å¤§è·¯", "ç¥å®‰è·¯", "å¤æµªè·¯", "æ­¦å¨ä¸œè·¯", "ä¸Šæµ·è¥¿ç«™",
    "é“œå·è·¯", "æ¢…å²­åŒ—è·¯", "å¤§æ¸¡æ²³è·¯", "é•¿é£å…¬å›­", "å¨„å±±å…³è·¯", "çº¢å®çŸ³è·¯", "å§šè™¹è·¯",
    "å´ä¸­è·¯", "æ¡‚æ—è·¯", "æ¡‚æ—å…¬å›­", "ä¸Šæµ·å—ç«™", "åä¸œç†å·¥å¤§å­¦", "ç½—ç§€è·¯", "æœ±æ¢…è·¯",
    "åæ³¾è¥¿", "è™¹æ¢…å—è·¯", "æ™¯è¥¿è·¯", "æ›™å»ºè·¯", "åŒæŸè·¯", "å…ƒæ±Ÿè·¯", "æ°¸å¾·è·¯", "ç´«ç«¹é«˜æ–°åŒº",
    # 16å·çº¿
    "é¾™é˜³è·¯", "åå¤ä¸­è·¯", "ç½—å±±è·¯", "å‘¨æµ¦ä¸œ", "é¹¤æ²™èˆªåŸ", "èˆªå¤´ä¸œ", "æ–°åœº", "é‡ç”ŸåŠ¨ç‰©å›­",
    "æƒ å—", "æƒ å—ä¸œ", "ä¹¦é™¢", "ä¸´æ¸¯å¤§é“", "æ»´æ°´æ¹–",
    # 17å·çº¿
    "è™¹æ¡¥ç«è½¦ç«™", "è¯¸å…‰è·¯", "èŸ é¾™è·¯", "å¾ç›ˆè·¯", "å¾æ³¾åŒ—åŸ", "å˜‰æ¾ä¸­è·¯", "èµµå··", "æ±‡é‡‘è·¯",
    "é’æµ¦æ–°åŸ", "æ¼•ç›ˆè·¯", "æ·€å±±æ¹–å¤§é“", "æœ±å®¶è§’", "ä¸œæ–¹ç»¿èˆŸ",
    # 18å·çº¿
    "é•¿æ±Ÿå—è·¯", "æ®·é«˜è·¯", "ä¸Šæµ·è´¢ç»å¤§å­¦", "å¤æ—¦å¤§å­¦", "å›½æƒè·¯", "æŠšé¡ºè·¯", "æ±Ÿæµ¦è·¯",
    "æ±Ÿæµ¦å…¬å›­", "å¹³å‡‰è·¯", "ä¸¹é˜³è·¯", "æ˜Œé‚‘è·¯", "æ°‘ç”Ÿè·¯", "æ¨é«˜ä¸­è·¯", "è¿æ˜¥è·¯", "é¾™é˜³è·¯",
    "èŠ³èŠ¯è·¯", "åŒ—ä¸­è·¯", "è²æºªè·¯", "å¾¡æ¡¥", "åº·æ¡¥", "å‘¨æµ¦", "ç¹è£è·¯", "æ²ˆæ¢…è·¯", "é¹¤æ¶›è·¯",
    "ä¸‹æ²™", "èˆªå¤´",
    # æµ¦æ±Ÿçº¿
    "æ²ˆæœå…¬è·¯", "ä¸‰é²å…¬è·¯", "é—µç‘è·¯", "æµ¦èˆªè·¯", "ä¸œåŸä¸€è·¯", "æ±‡è‡»è·¯"
]
# AI promptä½¿ç”¨ç¤ºä¾‹ï¼šæˆ‘å¥³å‹ä½åœ¨ä¸Šæµ·å—ç«™ï¼Œæˆ‘åœ¨å¤§è¿è·¯åœ°é“ç«™ä¸Šç­ï¼Œæˆ‘è¦æ‰¾é è¿‘åœ°é“ç«™çš„æˆ¿å­ï¼Œè¯·å¸®æˆ‘æ’é™¤å®Œå…¨ä¸ç›¸å¹²çš„åœ°é“çº¿è·¯

# !/bin/env python3
# -*- coding: utf-8 -*
# """
# cron: 5 9 * * * weibo_summary.py
# new Env('è±†ç“£ç§Ÿæˆ¿');
# """
from douban_scraper import DoubanScraper
import time

summary_list = []

# # æ’é™¤é¡¹
user_black_list = [
    "æ¨æµ¦ç§Ÿæˆ¿", "äº”è§’åœºç§Ÿèµ", "äº”è§’åœºç§Ÿæˆ¿", "PiNa@ä¸Šæµ·ç›´ç§Ÿ", "äº”è§’åœºé™„è¿‘", "æ²ªä¸Šèœ—å±…å°è±†è±†",
    "ğŸƒ ğŸ‡¨ğŸ‡³", "è±†å‹280014083", "ç“œç“œä¸€å·çš„å¢¨è¿¹",
    "é»„æµ¦åŒºç§Ÿæˆ¿",
    "å¨œå¨œå°å¤­", "è‡ªç”±å¥”æ”¾", "æ±Ÿæ¹–ä¸è‰¯äºº",
    "åå¤ä¸œè·¯", "æ¸…é£ç§€é›…",
    "çµæ„Ÿä¹‹åˆƒ", "ç»™ä½ ä¿©çªçª", "ç®€å•ç‚¹", "å¿§ä¼¤çš„æ—‹å¾‹", "C",
    "ä¹å¤´å¥ˆå­", "è±†å‹dda93.0249",
    "å…”ä¹ä¹", "å¿˜è®°äº†ä¸è¯¥å¿˜çš„",
    "æå¥½é—²ã€‚", "å°å¼ è¦å¢è‚Œ", "è™šä¼ªçš„ä¸–ç•Œ",
    "æ£®å¥³ä¸é¹¿æ—", "æå­", "æ‚²ä¼¤çš„è¯—ç¯‡", "ç›¸æ€æˆæ®‡",
    "å®‰é™çš„ç­‰å¾…", "-Joker",
    "è±†å‹279607317", "è±†å‹273774333", "æ—§æ¢¦ä¹±å¿ƒ", "å¤±å® çš„çŒ«", "æ°§æ°”æŸ æª¬çº¢èŒ¶",
    "è±†å‹279607320", "è±†å‹270169870",
    "è±†å‹279607122", "ç¥ˆé¹¤", "å¯æ€œå¼.æš§æƒ…",
    "å¦‚èŠ±ç¾çœ·", "è±†å‹279434723", "è±†å‹279434727", "ä»æ‚²ä¼¤ä¸­æŠ½ç¦»", "è±†å‹1HLEH7JXr4",
    "ä¸€åˆ‡éƒ½æŒºå¥½", "Choo", "sweet", "ä¹å„¿",
    "Foo", "å…‹å…‹", "ç¨šæ°”",
    "å¦®å¦®", "æˆ‘è£…ä½œé±¼", "æƒ³å½“è‹±é›„å°æ³¢æ¯”",
    "æ¬£æ¬£",
]

processed_links = set()


def format_output(text, time, user, href):
    """
    æ ¼å¼åŒ–è¾“å‡ºä¸€è¡Œæ•°æ®
    @param text: æ ‡é¢˜æ–‡æœ¬
    @param time: æ—¶é—´
    @param user: ç”¨æˆ·å
    @param href: é“¾æ¥
    @return: æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²
    """

    # è®¡ç®—å­—ç¬¦ä¸²æ˜¾ç¤ºå®½åº¦çš„å‡½æ•°
    def get_string_width(s):
        width = 0
        for c in s:
            width += 2 if ord(c) > 127 else 1
        return width

    # ç¡®ä¿æ–‡æœ¬æ˜¾ç¤ºå®½åº¦ä¸ºæŒ‡å®šå€¼çš„å‡½æ•°
    def pad_text_to_width(text, target_width):
        current_width = get_string_width(text)
        if current_width > target_width:
            # å¦‚æœæ–‡æœ¬è¿‡é•¿ï¼Œç›´æ¥æˆªæ–­
            result = ""
            width = 0
            for c in text:
                char_width = 2 if ord(c) > 127 else 1
                if width + char_width > target_width:
                    break
                result += c
                width += char_width
            return result
        else:
            # è¡¥å……ç©ºæ ¼åˆ°ç›®æ ‡å®½åº¦
            return text + " " * (target_width - current_width)

    # å›ºå®šå„ä¸ªéƒ¨åˆ†çš„å®½åº¦
    title_target_width = 90
    user_width = 15
    link_width = 85  # å›ºå®šé“¾æ¥æ˜¾ç¤ºå®½åº¦

    # å¤„ç†æ ‡é¢˜ï¼Œç¡®ä¿æ˜¾ç¤ºå®½åº¦ä¸¥æ ¼ç­‰äº90
    truncated_text = pad_text_to_width(text, title_target_width)

    # å¤„ç†ç”¨æˆ·å
    truncated_user = (user[:14] + ".").ljust(user_width) if len(user) > 14 else user.ljust(user_width)

    # å¤„ç†é“¾æ¥
    truncated_href = href[:link_width] if len(href) > link_width else href.ljust(link_width)

    # ç»„åˆè¾“å‡ºè¡Œ
    return f"{truncated_text}{time} {truncated_user}{truncated_href}"


def filter_content(item: dict) -> bool:
    """
    è¿‡æ»¤å†…å®¹

    Args:
        item: å¸–å­ä¿¡æ¯å­—å…¸
    Returns:
        bool: True è¡¨ç¤ºé€šè¿‡è¿‡æ»¤ï¼ŒFalse è¡¨ç¤ºè¢«è¿‡æ»¤æ‰
    """
    # æ£€æŸ¥é“¾æ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡
    if item['link'] in processed_links:
        return False

    # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦åœ¨é»‘åå•ä¸­
    if item['author'] in user_black_list:
        return False

    # æ’é™¤é¡¹å…³é”®è¯æ£€æŸ¥
    blackList = [
        "å¥³ç”Ÿ", "æˆ¿æº", "å…¬ç§¯é‡‘", "å±…ä½è¯", "é’¥åŒ™", "åˆ«å¢…",
        "æ±‚ç§Ÿ", "é¢„ç®—", "æœ‰æ²¡æœ‰",
        # "é—µè¡Œ", "å¾å®¶æ±‡", "æ¼•æ²³æ³¾", "æ¼•å®", "ä¸ƒå®", "è™¹æ¡¥",
        "è˜åº„",
        "é’æµ¦", "æ³—æ³¾", "å‘¨æµ¦",
        "å®å±±", "ä¸Šæµ·å¤§å­¦", "å‘¼å…°", "å½­æµ¦",
        "å˜‰å®š",
        "è™¹æ¡¥å•†åŠ¡åŒº",
        "æµ¦ä¸œ", "é™†å®¶å˜´", "å¼ æ±Ÿ",
        "ä¸–çºªå…¬å›­", "é¾™é˜³è·¯",
        # "é™å®‰",
        "æ™®é™€",
        "åŒ—æ–°æ³¾",
        # åœ°é“
        "é•¿æ±Ÿå—è·¯",
        "ä¸Šæµ·é©¬æˆåŸ",
        "å›½å®¶ä¼šå±•ä¸­å¿ƒ", "æ·è™¹è·¯", "åŒ—æ–°æ³¾",
        "äº”å·çº¿", "5å·çº¿", "é—µè¡Œå¼€å‘åŒº",
        "6å·çº¿", "æ¸¯åŸè·¯", "ä¸œæ–¹ä½“è‚²ä¸­å¿ƒ", "æ´²æµ·è·¯",
        "7å·çº¿", "èŠ³åè·¯", "ä¸Šå¤§è·¯", "äº‘å°è·¯", "æ¨æ€", "ä¸–åš", "èŠ±æœ¨", "å¤§åä¸‰è·¯",
        "å…«å·çº¿", "8å·çº¿", "è”èˆªè·¯",
        "9å·çº¿", "ä¹äº­", "æ¾æ±Ÿ", "åˆå·è·¯",
        "11å·çº¿", "èŠ±æ¡¥", "è¿ªå£«å°¼",
        "é‡‘è¿è·¯", "å·¨å³°è·¯",
        "14å·çº¿", "å°æµœ", "æ›¹è·¯", "çœŸå…‰è·¯",
        "15å·çº¿", "æ›™å»ºè·¯", "æ°¸å¾·è·¯", "ä¸Šæµ·è¥¿ç«™",
        "16å·çº¿", "é¾™é˜³è·¯", "æµ¦ä¸œæœºåœº", "é¡¾å”è·¯",
        "17å·çº¿", "è¯¸å…‰è·¯", "ä¸œæ–¹ç»¿èˆŸ",
        "18å·çº¿", "èˆªå¤´", "æ»´æ°´æ¹–", "å¾¡æ¡¥",
        "19å·çº¿", "è™¹æ¼•è·¯", "é«˜å®‰è·¯",
        "20å·çº¿", "é‡‘æ¡¥", "èˆªåŸ",
        "21å·çº¿", "ä¸œæ–¹ä½“è‚²ä¸­å¿ƒ", "å‰æ»©", "ä¸‰æ—",
        "23å·çº¿", "å´æ³¾", "çŸ³é¾™è·¯", "ç´«ç«¹",
        "26å·çº¿", "é—µè¡Œå¼€å‘åŒº", "å‰‘å·è·¯",
        "å¥‰è´¤", "æµ·æ¹¾",
    ]

    for keyword in blackList:
        if keyword in item['title']:
            # print(f"è¿‡æ»¤ï¼šæ ‡é¢˜åŒ…å«å…³é”®è¯ '{keyword}' - {href}")
            return False

    return True


def print_discussions(discussions: list):
    """æ‰“å°è®¨è®ºåˆ—è¡¨"""
    # å¦‚æœæ˜¯ç¬¬ä¸€æ¡æ•°æ®ï¼Œå…ˆæ‰“å°è¡¨å¤´
    if len(summary_list) == 0:
        print("\n" + "=" * 160)
        print(format_output("æ ‡é¢˜", "æ—¶é—´", "ç”¨æˆ·", "é“¾æ¥"))
        print("-" * 160)

    for item in discussions:
        if filter_content(item):
            output_line = format_output(
                item['title'],
                item['time'],
                item['author'],
                item['link']
            )
            print(output_line)
            processed_links.add(item['link'])
            summary_list.append(item)


def get_top_summary(start: int = 0, max_items: int = 20, max_pages: int = 5):
    """
    è·å–ç§Ÿæˆ¿ä¿¡æ¯æ‘˜è¦

    Args:
        start: èµ·å§‹ä½ç½®
        max_items: æœ€å¤§è·å–æ¡ç›®æ•°
        max_pages: æœ€å¤§é¡µæ•°é™åˆ¶
    """
    scraper = DoubanScraper()
    try:
        current_page = start
        while len(summary_list) < max_items and current_page < max_pages * 25:
            page_num = current_page // 25

            # è·å–å½“å‰é¡µæ•°æ®
            discussions = scraper.get_group_discussions('shanghaizufang', page_num)

            if not discussions:
                print("æœªè·å–åˆ°æ•°æ®ï¼Œå¯èƒ½æ˜¯é¡µé¢ç»“æ„å˜åŒ–æˆ–åçˆ¬é™åˆ¶")
                break

            print_discussions(discussions)
            # æ›´æ–°é¡µç 
            current_page += 25
            # æ·»åŠ å»¶æ—¶ï¼Œé¿å…è¯·æ±‚è¿‡å¿«
            time.sleep(2)

    except Exception as e:
        print(f"è·å–æ•°æ®å¤±è´¥: {str(e)}")
        import traceback
        print(f"è¯¦ç»†é”™è¯¯ä¿¡æ¯: {traceback.format_exc()}")
    finally:
        scraper.close()


if __name__ == '__main__':
    processed_links = set()
    summary_list = []
    get_top_summary()
